<!-- user_profile.html -->

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>{{ user.username }}'s Profile</title>
</head>
<body>
    <a href="{% url 'posts:posts_index' %}">Back</a>
    <h1>{{ user.username }}'s Profile</h1>
    <p>Email: {{ user.email }}</p>

    <!-- Follow/Unfollow -->
    <p>Followers: {{ followers_count }}</p>
    <p>Following: {{ following_count }}</p>
    {% if user != request.user %} <!-- To prevent user from following themselves -->
        {% if is_following %}
            <form method="post" action="{% url 'accounts:user_profile' username=user.username %}">
                {% csrf_token %}
                <button type="submit" name="unfollow">Unfollow</button>
            </form>
        {% else %}
            <form method="post" action="{% url 'accounts:user_profile' username=user.username %}">
                {% csrf_token %}
                <button type="submit" name="follow">Follow</button>
            </form>
        {% endif %}
    {% endif %}
    <!-- End of follow/unfollow -->
    
    <!-- Link to conversations or message button -->
    {% if user == request.user %}
        <p><a href="{% url 'chat:conversation_list' %}">Conversations</a></p>
    {% else %}
        <p><a href="{% url 'chat:start_conversation' username=user.username %}">Message</a></p>
    {% endif %}


    <h2>Posts</h2>
    <!-- Display posts here -->

    {% for post in posts %}
        <div>
            <h2>{{ post.name }}</h2>
            <p>{{ post.description }}</p>
            <p>Location: {{ post.location }}</p>
            <p>Date Missing: {{ post.date_missing }}</p>
            <p>Posted by:<a href="{% url 'accounts:user_profile' username=post.user.username %}">{{ post.user.username }}</a></p>
            <!-- Display image -->
            <img src="{{ post.photo.url }}" alt="{{ post.name }} Photo">
        </div>
        <button><a href="{% url 'posts:view_post_details' post.id %}">View More Details</a></button>
    {% endfor %}

</body>
</html>
