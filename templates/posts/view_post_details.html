{% extends 'common/base.html' %}
{% load static %}

{% block title %}Post Details{% endblock %}

{% block content %}
<div class="container post-details">
    <h3 class="mb-4">{{ post.name }} Post Details</h3>
    
    <div class="post">
        <h2>{{ post.name }}</h2>
        <p>{{ post.description }}</p>
        <p>Location: {{ post.location }}</p>
        <p>Date Missing: {{ post.date_missing }}</p>
        <p>Posted by: <a href="{% url 'accounts:user_profile' username=post.user.username %}">{{ post.user.username }}</a></p>
        <img src="{{ post.photo.url }}" alt="{{ post.name }} Photo" class="img-fluid">
        
        <!-- Buttons for reactions and comments -->
        <div class="mt-4 mb-4">
            <button class="btn btn-primary mr-2"><a href="{% url 'posts:comment_on_post' post.id %}" class="text-white">Comment</a></button>
            <button class="btn btn-secondary mr-2"><a href="{% url 'posts:react_to_post' post.id %}" class="text-white">React</a></button>
            {% if post.user == request.user %}
                <button class="btn btn-danger"><a href="{% url 'posts:delete_post' post.id %}" class="text-white">Delete</a></button>
            {% endif %}
        </div>
    </div>

    <!-- Comment section -->
    <div class="comment-section">
        <h3 class="mb-3">Comments:</h3>
        {% for comment in comments %}
            <div class="comment">
                <p><strong>{{ comment.user.username }}:</strong> {{ comment.text }}</p>
                <p><em>Posted on: {{ comment.timestamp }}</em></p>
                <!-- Button to reply to this comment -->
                <button class="btn btn-info btn-sm"><a href="{% url 'posts:reply_to_comment' comment.id %}" class="text-white">Reply</a></button>
            </div>
            <!-- Display replies to this comment -->
            {% for reply in comment.replies.all %}
                <div class="reply">
                    <p><strong>{{ reply.user.username }} (Reply to {{ comment.user.username }}):</strong> {{ reply.text }}</p>
                    <p><em>Replied on: {{ reply.timestamp }}</em></p>
                </div>
            {% endfor %}
        {% endfor %}
    </div>
</div>
{% endblock %}
